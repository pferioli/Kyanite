<%- include ("../partials/header") %>

<% if(locals.metadata && locals.metadata.length>0) { %>
<% var client =metadata[0] %>
<% } %>

<main class="site-content">
  <div class="container" style="margin-top: 50px;">
    <form class="col s12 m6" method="post" action='/clients/new'>
      <div class="card">
        <div class="card-content">
          <span class="card-title">Alta de un nuevo cliente</span>
          <div class="row" style="margin-top: 20px;">
            <div class="input-field col s12">
              <i class="material-icons prefix">home</i>
              <input id="name" name="name" type="text" class="validate" data-length="128"
                <% if(locals.metadata && locals.metadata.length>0) { %> value="<%=metadata[0].name%>" <% } %>
                required />
              <label for="name">Nombre del Barrio</label>
            </div>
          </div>
          <div class="row">
            <div class="input-field col s3">
              <i class="material-icons prefix">info_outline</i>
              <input id="internalCode" name="internalCode" type="text" class="validate" maxlength="3" minlength="2"
                pattern="[A-Z]{2}[0-9]{0,1}" onkeyup="this.value = this.value.toUpperCase();"
                title="El código de barrio deben ser una combinación de 2 a 3 digitos compuesto por letras mayusculas y números"
                <% if(locals.metadata && locals.metadata.length>0) { %> value="<%=metadata[0].internalCode%>" <% } %>
                required />
              <label for="codigo">Codigo Interno</label>
            </div>
            <div class="input-field col s3">
              <input id="cuit" name="cuit" type="text" class="validate" maxlength="13" minlength="13"
                pattern="^(20|23|27|30|33)([0-9]{9}|-[0-9]{8}-[0-9]{1})$"
                <% if(locals.metadata && locals.metadata.length>0) { %> value="<%=metadata[0].cuit%>" <% } %>
                required />
              <label for="cuit">C.U.I.T.</label>
            </div>
            <div class="input-field col s6">
              <select id="taxCategorySelect">
                <% for(var i=0; i < data.taxCategories.length; i++) { %>
                <option value="<%=data.taxCategories[i].id%>"><%= data.taxCategories[i].name %></option>
                <% } %>
              </select>
              <label>Categoria Impositiva</label>
            </div>
          </div>
          <input type="hidden" name="taxCategory" id="taxCategory" />
          <div class="row">
            <div class="input-field col s9">
              <i class="material-icons prefix">mail</i>
              <input id="email" name="email" type="email" class="validate"
                <% if(locals.metadata && locals.metadata.length>0) { %> value="<%=metadata[0].email%>" <% } %> />
              <label for="email">Correo Electronico</label>
              <span class="helper-text" data-error="el formato de la dirección es inválida">correo electrónico de
                contácto del barrio</span>
            </div>
            <div class="input-field col s3">
              <i class="material-icons prefix">local_phone</i>
              <input id="phone" name="phone" type="tel" class="validate"
                pattern="\([0-9]{2,3,4}\) [0-9]{3,4}[ -][0-9]{4}" placeholder="(Código de área) Número"
                title="(Codigo de Area de 2 a 4 digitos) seguido de un espacio, la caracteristica de 3 o 4 digitos un espacio o guión y los 4 digitos finales"
                <% if(locals.metadata && locals.metadata.length>0) { %> value="<%=metadata[0].phone%>" <% } %> />
              <label for="phone">Telefono</label><span class="helper-text" data-error="formato inválido">(xxx)
                [xxxx-xxxx]</span>
            </div>
          </div>
          <div class="row">
            <div class="input-field col s6">
              <i class="material-icons prefix">location_on</i>
              <input id="address" name="address" type="text" class="validate"
                <% if(locals.metadata && locals.metadata.length>0) { %> value="<%=metadata[0].address%>" <% } %> />
              <label for="address">Direccion</label>
            </div>
            <div class="input-field col s3">
              <i class="material-icons prefix">location_city</i>
              <input id="city" name="city" type="text" class="validate"
                <% if(locals.metadata && locals.metadata.length>0) { %> value="<%=metadata[0].city%>" <% } %> />
              <label for="city">Ciudad</label>
            </div>
            <div class="input-field col s3">
              <i class="material-icons prefix">details</i>
              <input id="zipCode" name="zipCode" type="text" class="validate"
                <% if(locals.metadata && locals.metadata.length>0) { %> value="<%=metadata[0].zipCode%>" <% } %> />
              <label for="zipCode">Codigo Postal</label>
            </div>
          </div>
          <div class="row">
            <div class="input-field col s12">
              <textarea id="comments" name="comments" class="materialize-textarea"
                <% if(locals.metadata && locals.metadata.length>0) { %> value="<%=metadata[0].comments%>" <% } %>>
              </textarea>
              <label for="comments">Observaciones</label>
            </div>
          </div>
        </div>
        <div class="card-action right-align">
          <button type='submit' class="waves-effect waves-light btn green" style="margin-right: 10px;"><i
              class="material-icons right">save</i>Guardar</button>
          <a href="/clients" class="waves-effect waves-light btn red"><i
              class="material-icons right">cancel</i>Cancelar</a>
        </div>
      </div>
    </form>
  </div>
  <div>
    <center>
      <%- include ("../partials/alerts") %>
    </center>
</main>

<%- include ("../partials/footer") %>

<script>
  document.addEventListener("DOMContentLoaded", function () {
    var elems = document.querySelectorAll("select");
    var instances = M.FormSelect.init(elems, {});
  });

  $(document).ready(function () {
    $('input#razon_social, textarea#observaciones').characterCounter();

    $('#taxCategorySelect').on('change', function () {
      var sel = $('#taxCategorySelect').val()
      $('#taxCategory').val(sel);
    });
  });
</script>