<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.7.2/Chart.bundle.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/numeral.js/2.0.6/numeral.min.js"></script>
<script src="https://unpkg.com/@cubejs-client/core@0.6.0/dist/cubejs-client-core.js"></script>

<%- include ("partials/header") %>

<main class="site-content">

    <div class="container" id="app">
        <div class="row">
            <div class="col s4">
                <div class="card">
                    <div class="card-content">
                        <span class="card-title">Total de Clientes</span>
                        <h3 id="total-clients"></h3>
                    </div>
                </div>
            </div>
            <div class="col s4">
                <div class="card">
                    <div class="card-content">
                        <span class="card-title">Total de Proveedores</span>
                        <h3 id="total-suppliers"></h3>
                    </div>
                </div>
            </div>
            <div class="col s4">
                <div class="card">
                    <div class="card-content">
                        <span class="card-title">Total de Usuarios</span>
                        <h3 id="total-users"></h3>
                    </div>
                </div>
            </div>
        </div>
        <br />
        <br />
    </div>
</main>

<script>
    var cubejsApi = cubejs(
        'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyIjoiZmVyaW9saUBhci5pYm0uY29tIiwiaWF0IjoxNTk5NDE5MDk3LCJleHAiOjE1OTk0MTkwOTd9.i_kQyQAQjujOU0TSJJBCcbQd3A86pP4Jj4Ter_Lq4yY',
        { apiUrl: 'http://localhost:3000/cubejs-api/v1' }
    );

    var kpis = [
        { measure: "Users.count", element: "total-users" },
    ];

    kpis.forEach(kpi => {
        cubejsApi.load({
            measures: [kpi.measure]
        }).then(resultSet => {
            document.getElementById(kpi.element).textContent =
                numeral(resultSet.totalRow()[kpi.measure]).format('0,0');
        })
    });

</script>